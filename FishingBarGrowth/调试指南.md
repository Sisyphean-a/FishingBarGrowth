# 调试指南 / Debug Guide

## 问题1: 已钓鱼数显示为0

### 可能的原因

1. **fishCaught字典为空**: 游戏数据中没有钓鱼记录
2. **物品ID格式问题**: 1.6版本的ID格式可能不同
3. **鱼类识别逻辑问题**: ObjectType或Category判断不正确
4. **藻类过滤过度**: 所有鱼都被错误地过滤掉了

### 调试步骤

#### 步骤1: 启用调试日志

1. 打开游戏
2. 进入**选项菜单** → **Mod选项** (需要Generic Mod Config Menu)
3. 找到 **Fishing Bar Growth**
4. 滚动到 **调试设置** 部分
5. 启用 **显示调试信息**
6. 保存并关闭菜单

#### 步骤2: 触发统计

1. 手持鱼竿
2. 开始钓鱼(不需要真的钓到,只要进入钓鱼小游戏即可)
3. 查看SMAPI控制台

#### 步骤3: 分析日志

在SMAPI控制台中查找以下信息:

```
[FishCounter] 开始统计鱼类, fishCaught字典大小: X
[FishCounter] 检查物品ID: XXX, 数量: X
[FishCounter]   -> 物品类型: XXX, 类别: X
[FishCounter] ✓ 有效鱼类: XXX, 数量: X
[FishCounter] ✗ 排除: XXX, 数量: X
[FishCounter] 统计完成 - 总计: X条, 有效种类: X, 排除种类: X
```

### 日志解读

#### 情况A: fishCaught字典大小为0
```
[FishCounter] 开始统计鱼类, fishCaught字典大小: 0
```
**原因**: 游戏中确实没有钓鱼记录
**解决**: 先钓几条鱼,然后重新测试

#### 情况B: 所有鱼都被排除
```
[FishCounter] 统计完成 - 总计: 0条, 有效种类: 0, 排除种类: 10
```
**原因**: 鱼类识别逻辑有问题
**解决**: 查看具体的排除原因,可能需要调整识别逻辑

#### 情况C: 物品类型为null
```
[FishCounter]   -> 物品类型: null, 类别: 0
```
**原因**: ItemRegistry返回的数据不完整
**解决**: 可能需要使用其他方法识别鱼类

#### 情况D: ID格式问题
```
[FishCounter]   -> 无法获取物品数据: (O)XXX
```
**原因**: ID格式不正确
**解决**: fishCaught中的ID可能已经是qualified ID

### 反馈信息模板

请将以下信息反馈给开发者:

```
【环境信息】
- 游戏版本: 
- SMAPI版本: 
- Mod版本: 1.0.0

【问题描述】
- HUD显示已钓鱼数: 0
- 实际钓鱼数量: 约XXX条

【调试日志】
(复制SMAPI控制台中所有[FishCounter]开头的日志)

【配置信息】
- 排除藻类: 是/否
- 启用Mod: 是/否
```

## 问题2: HUD显示优化

### 已修复

- ✅ 默认Y位置从100改为180像素
- ✅ 背景高度从100改为140像素
- ✅ 背景宽度从300改为380像素
- ✅ 修复基础高度显示错误(现在正确显示等级+装备计算的高度)
- ✅ 未钓鱼时显示"请先开始钓鱼以获取数据"提示

### 手动调整

如果默认位置仍不合适,可以在配置中调整:

1. **HUD水平位置**: 控制距离屏幕左边缘的距离
   - 范围: 0-500像素
   - 默认: 20像素
   - 建议: 保持默认

2. **HUD垂直位置**: 控制距离屏幕底部的距离
   - 范围: 0-500像素
   - 默认: 180像素
   - 建议: 如果还是看不到最后一行,继续增加(如200、220等)

### 测试方法

1. **未钓鱼时** - 手持鱼竿,应显示:
   ```
   === 钓鱼统计 ===
   已钓鱼数: XXX 条
   请先开始钓鱼以获取数据
   ```

2. **钓鱼后** - 开始钓鱼后,应显示:
   ```
   === 钓鱼统计 ===
   已钓鱼数: XXX 条
   钓鱼条长度: XXX px
     (基础: 176 + 奖励: XX)
   ```
   注: 基础高度 = 96 + 等级×8 + 装备加成

3. 如果第4行被截断,增加Y位置值

## 其他调试技巧

### 查看原始fishCaught数据

可以在SMAPI控制台中输入以下命令(如果有调试mod):
```
player_stats
```

### 临时禁用藻类过滤

在配置中关闭"排除藻类",看看总数是否增加。如果增加了,说明识别逻辑正常,只是你钓的都是藻类。

### 检查Harmony补丁状态

查看SMAPI控制台启动日志,确认:
```
[Fishing Bar Growth] Harmony补丁已成功应用
```

如果看到错误,说明补丁没有正确应用。

## 联系支持

如果问题仍未解决,请提供:
1. 完整的SMAPI日志 (smapi-latest.log)
2. 调试日志截图
3. 配置文件 (config.json)
4. 游戏存档信息 (可选)

